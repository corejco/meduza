<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Meduza Jetton Metadata Updater</title>

  <!-- TonConnect 2.0 -->
  <script src="https://unpkg.com/@tonconnect/sdk@2.2.0/dist/tonconnect-sdk.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      max-width: 600px;
    }
    button {
      padding: 12px 18px;
      font-size: 16px;
      margin-top: 10px;
      width: 100%;
      cursor: pointer;
    }
    #status {
      margin-top: 15px;
      padding: 10px;
      background: #f3f3f3;
      border-radius: 6px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h2>Meduza Jetton — Обновление Metadata</h2>

  <button id="connectBtn">Подключить Tonkeeper</button>
  <button id="updateBtn" disabled>Обновить Metadata</button>

  <div id="status">Кошелек не подключён.</div>

  <script>
    const minterAddress = "EQCpP5G76znZMaCeJ5iZH6Ugi8GOZNWdN0RLmW9Yl346wqDa";
    const newMetadataURI = "https://arweave.net/YUPEZBI7PHWn0uNHVqeLpdiIjviaS-iFB9f0yiiLspM";

    // Инициализация TonConnect v2
    const connector = new TON_CONNECT.TonConnect({
      manifestUrl: window.location.origin + "/tonconnect-manifest.json"
    });

    const connectBtn = document.getElementById("connectBtn");
    const updateBtn = document.getElementById("updateBtn");
    const status = document.getElementById("status");

    // Обработка подключения
    connectBtn.onclick = async () => {
      try {
        await connector.connectWallet();
        const wallet = connector.wallet;
        status.textContent = "Подключено: " + wallet.account.address;
        updateBtn.disabled = false;
      } catch (err) {
        console.error(err);
        alert("Ошибка подключения Tonkeeper");
      }
    };

    // Отправка транзакции
    updateBtn.onclick = async () => {
      if (!connector.wallet) return;

      const payload = TON_CONNECT.concatTonCell({
        jetton_content: newMetadataURI
      });

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300,
        messages: [
          {
            address: minterAddress,
            amount: "50000000", // 0.05 TON
            payload
          }
        ]
      };

      try {
        await connector.sendTransaction(tx);
        alert("Транзакция отправлена!");
      } catch (err) {
        console.error(err);
        alert("Ошибка отправки транзакции");
      }
    };
  </script>
</body>
</html>
