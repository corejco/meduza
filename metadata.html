<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Update Jetton Metadata</title>
  <script src="https://cdn.jsdelivr.net/npm/tonweb@0.21.0/dist/tonweb.min.js"></script>
  <script src="https://unpkg.com/@tonconnect/sdk@1.1.0/dist/tonconnect-sdk.umd.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    button { margin: 0.5em 0; padding: 0.5em 1em; font-size: 1em; }
  </style>
</head>
<body>
  <h1>Обновление Jetton Metadata</h1>
  <button id="connect">Подключить Tonkeeper</button>
  <button id="update" disabled>Обновить Metadata</button>

  <script>
    const minterAddress = "";
    const newMetadataURI = "";

    let wallet = null;

    const connector = new TonConnectSDK.TonConnect({
      manifestUrl: window.location.origin + '/tonconnect-manifest.json'
    });

    document.getElementById("connect").onclick = async () => {
      try {
        const connectedWallet = await connector.connect();
        wallet = connectedWallet.account;
        alert("Кошелек подключен: " + wallet.address);
        document.getElementById("update").disabled = false;
      } catch (e) {
        alert("Ошибка подключения Tonkeeper");
        console.error(e);
      }
    };

    document.getElementById("update").onclick = async () => {
      if (!wallet) return;

      try {
        const tonweb = new TonWeb(new TonWeb.HttpProvider("https://toncenter.com/api/v2/jsonRPC"));
        const minter = new TonWeb.JettonMinter(tonweb.provider, minterAddress);

        const txMessage = minter.methods.changeJettonContent(newMetadataURI).toMessage();

        const txResult = await connector.sendTransaction({
          messages: [
            {
              address: minterAddress,
              amount: TonWeb.utils.toNano("0.05").toString(),
              payload: txMessage.toBoc().toString("base64")
            }
          ]
        });

        alert("Транзакция отправлена!");
      } catch (e) {
        alert("Ошибка при отправке транзакции");
        console.error(e);
      }
    };
  </script>
</body>
</html>
